# 主控软件版本更新日志


## V1.1.8

##### 新增:

- 关机状态下可通过IOT云平台发送期望值使车辆复位（升级用）

##### 修复:

- 取消解锁时发送零速制动指令，零速制动可能导致部分驱动器驱动有问题

##### 新修复:
- 期望值主题数组由于部分设备devicename过长导致数组越界看门狗复位
- 期望值接收+MSUB标识判断导致bootload跳转运行后失败，更改为判断desired标识符

## V1.1.7

##### 特性:   
- 遥控器原地转向比例增大、差速比例减小
- 自动挡增加比例后退逻辑
- 开机状态大灯可控制开关

##### 新增:
- 遥控器控制比例优化
- 遥控器解锁按钮须在水泵风机开关关闭之后才能解锁
- 遥控器解锁按钮再遥控器重连、关机；水泵风机锁打开再关闭后需重新拨回关闭状态再解锁才成功
- 增加主控发送消息给4G错误后次数累计并在关机状态下复位逻辑
- 增加S48100 B样辅助充电机进行充电
- 关闭基站定位


##### 修复:
运行记录：
- 运行记录时间校准由GPS授时更改为4G芯片实时时间
- 增加运行记录上传后结构体清空逻辑
- 修改运行记录ID为起始时间加结束时间后六位
- 修复运行记录由于起始时间获取失败、记录ID不匹配导致运行记录上传失败

数据上报：
- 串口空闲接收中断下关闭DMA通道更改为关闭DMA接收通道
- 增加数据上传后数组清空逻辑
- 坐标自动上报更改为运行状态1S，其余状态10S
- 修复主控处理接收4G数据频繁导致DMA发送过程中被关闭DMA截断数据发送
- MQTT联网状态查询、4G信号查询指令发送延迟查询变更为指令定时发送，任务接收处理

修复S48100电池温度上报x10的问题




## V1.1.4

##### 特性:   

##### 新增:

##### 修复:

- 修复轨迹上传失败问题



## V1.1.3

##### 特性:   

- 建议配合Bootloader V1.0.2使用

##### 新增:

- 新增水泵传感器液位、流量、压力信号读取

##### 修复:

- 优化绑定流程，提升绑定成功率



## V1.1.2

##### 特性:   

##### 新增:

- 新增基站定位，可在车辆GPS信号差时用于辅助定位

##### 修复:



## V1.1.1

##### 特性:   

##### 新增:

- 新增在线升级的部分代码

##### 修复:

- 优化4G通信逻辑，解决开机慢，通信断连等问题
- 优化代码结构和部分已知问题



## V1.1.0

##### 特性:   

##### 新增:

- 取消水泵的怠速
- IOT平台数据数据按照规定表显示

##### 修复:

- 修复手机端环境温度显示数值错误的问题
- 解决主控盒在装配后再连接电池，电池种类判断错误
- 解决手机绑定无提示音的问题
- 修复主控开盒状态显示混乱的问题，电驱板开盒显示存在问题



## V1.0.9

##### 特性:   

##### 新增:

##### 修复:

- 解决S48100电池充电无提示、风扇不转的问题
- 解决功能受限电量限制出错问题



## V1.0.8

##### 特性:   

- 配合BOOTLOAD_V1.0.1同时发布

##### 新增:

- 发布BOOTLOAD_V1.0.1，解决OTA缓冲区64K空间不够导致OTA升级失败的问题

##### 修复:

- 解决测试车1和正式车底盘控制逻辑不一致的问题，使用宏定义来区分



## V1.0.7

##### 特性:   

##### 新增:

- 新增一级低电量语音，二级低电量功能受控，灯效提醒
- 在灯板中加入空闲帧来保证左右灯板同步

##### 修复:

- 修复定速G_0档灯效显示错误的问题



## V1.0.6

##### 特性:   

- 通讯协议由自定义协议更换为CANopen，不支持软件版本号为V1.1.0之前的电驱板和传感器板（LED灯板可支持到V1.0.9）

##### 新增:

- 通讯协议由自定义协议更换为 CANopen
- 软开关关机时切断接触器，关机后无需再拍下急停
- 程序兼容超力源电池和 S48100 电池
- 风机受水泵开关控制，增加风机软起动，取消风机归零复位
- 新增关机状态下短按软开关显示电量功能
- 喷洒自动启停模式下，原地转向不喷洒
- 更新灯效显示，具体灯效更新见表
- 增加蜂窝信号质量上传IOT平台

##### 修复:

- 取消定速三档模式下拨杆上拨回到定速零档
- 修复定速模式下转弯半径过大的问题

